plugins {
    id "com.android.application"
    id "org.jetbrains.kotlin.android"
    id "dev.flutter.flutter-gradle-plugin"
    id "com.google.gms.google-services"
}

def keystoreProperties = new Properties()
def keystorePropertiesFile = rootProject.file("key.properties")
if (keystorePropertiesFile.exists()) keystoreProperties.load(new FileInputStream(keystorePropertiesFile))

android {
    namespace "com.sschoolapp.s_school_app" // TODO: set to your real namespace
    compileSdk 36 // Align with plugins that compile against Android 36
    ndkVersion flutter.ndkVersion

    defaultConfig {
        applicationId "com.sschoolapp.s_school_app" // TODO: set to your real applicationId
        minSdkVersion flutter.minSdkVersion // Keep aligned with Flutter's configured minSdk
        targetSdk 36
        versionCode 17 // TODO: bump per release
        versionName "1.0.16" // TODO: bump per release
        multiDexEnabled true
    }

    compileOptions {
        coreLibraryDesugaringEnabled true // Needed for desugar_jdk_libs 2.1.4+
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions { jvmTarget = "1.8" }

    packagingOptions {
        jniLibs.useLegacyPackaging = false // Required for modern Android/16KB page-size ready .so packaging
    }

    signingConfigs {
        release {
            // Prefer provided keystore; fall back to debug keystore so release always signs
            if (keystorePropertiesFile.exists()) {
                keyAlias keystoreProperties['keyAlias']
                keyPassword keystoreProperties['keyPassword']
                storeFile file(keystoreProperties['storeFile'])
                storePassword keystoreProperties['storePassword']
            } else {
                storeFile file("${System.properties['user.home']}/.android/debug.keystore")
                storePassword "android"
                keyAlias "androiddebugkey"
                keyPassword "android"
            }
            v1SigningEnabled true
            v2SigningEnabled true
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled true // Keep minification on for smaller APK/AAB
            shrinkResources true
            proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro"
        }
    }
}

flutter { source "../.." }

dependencies {
    coreLibraryDesugaring "com.android.tools:desugar_jdk_libs:2.1.4" // Matches coreLibraryDesugaringEnabled true

    implementation "androidx.core:core-ktx:1.13.1" // Modern AndroidX baseline
    implementation "androidx.activity:activity-ktx:1.9.2"
    implementation "androidx.browser:browser:1.8.0"

    implementation platform("com.google.firebase:firebase-bom:33.8.0")
}
